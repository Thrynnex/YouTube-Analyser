<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Analyzer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’Ž</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --background: #101010;
            --glass-bg: rgba(28, 28, 30, 0.75);
            --text-primary: #F5F5F7;
            --text-secondary: #A1A1A6;
            --accent: #0A84FF;
            --border-color: rgba(255, 255, 255, 0.12);
            --shadow-color: rgba(0, 0, 0, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            background-image:
                radial-gradient(at 0% 0%, hsla(215, 98%, 61%, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, hsla(285, 98%, 61%, 0.1) 0px, transparent 50%);
            animation: move-bg 30s ease-in-out infinite alternate;
            background-size: 200% 200%;
            padding-top: 80px; /* Offset for fixed top bar */
        }
        @keyframes move-bg {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 clamp(1rem, 5vw, 2.5rem);
            background: rgba(16, 16, 16, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
        }

        .github-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            background-color: transparent;
            border: 1px solid var(--text-secondary);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .github-btn:hover {
            border-color: var(--text-primary);
            color: var(--text-primary);
        }
        .github-btn svg {
            fill: currentColor;
            width: 20px;
            height: 20px;
        }

        .container {
            width: 100%;
            max-width: 1100px;
            padding: clamp(1rem, 5vw, 2.5rem);
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2.5rem;
        }
        header h1 {
            font-size: clamp(2rem, 5vw, 2.75rem);
            font-weight: 700;
            letter-spacing: -1px;
        }
        header p {
            font-size: clamp(1rem, 2.5vw, 1.1rem);
            color: var(--text-secondary);
            margin-top: 0.5rem;
            max-width: 600px;
            margin-inline: auto;
        }

        .input-card {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 8px 32px var(--shadow-color);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            display: flex;
            align-items: center;
            margin-bottom: 2.5rem;
            position: relative;
        }
        #videoUrl {
            flex-grow: 1;
            border: none;
            background: transparent;
            padding: 1.5rem;
            font-size: 1rem;
            color: var(--text-primary);
            padding-right: 130px; /* Space for the button */
        }
        #videoUrl:focus {
            outline: none;
        }
        #fetchButton {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            border: none;
            background-color: var(--text-primary);
            color: var(--background);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 110px;
            height: 48px;
            display: grid;
            place-items: center;
        }
        #fetchButton:hover:not(:disabled) {
            opacity: 0.9;
            transform: translateY(-50%) scale(1.03);
        }
        #fetchButton:disabled {
            background-color: #555;
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: translateY(-50%);
        }
        #fetchButton:disabled .btn-text {
            display: none;
        }
        #fetchButton .loader {
            display: none;
        }
        #fetchButton:disabled .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 50%;
            border-top-color: var(--text-secondary);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #status-message {
            text-align: center;
            min-height: 1.5rem;
            font-weight: 500;
            margin-bottom: 2.5rem;
        }
        .error {
            color: #ff6b6b;
        }

        .dashboard {
            display: none;
            opacity: 0;
            transition: opacity 0.6s ease;
        }
        .dashboard.visible {
            display: block;
            opacity: 1;
        }

        .dashboard-layout {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            flex-grow: 1;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .sidebar {
                flex-direction: row;
            }
            .sidebar > .card {
                flex: 1;
            }
        }
        @media (min-width: 1024px) {
            .dashboard-layout {
                flex-direction: row;
            }
            .sidebar {
                flex-direction: column;
                flex-basis: 320px;
                flex-shrink: 0;
            }
        }

        .card {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px var(--shadow-color);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            opacity: 0;
            transform: translateY(20px);
            animation: slide-up 0.6s ease forwards;
        }
        @keyframes slide-up {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .video-header .thumbnail {
            width: 100%;
            border-radius: 12px;
            aspect-ratio: 16/9;
            object-fit: cover;
            margin-bottom: 1.5rem;
            display: block;
        }
        .video-header .title {
            font-size: clamp(1.25rem, 4vw, 1.75rem);
            font-weight: 600;
            line-height: 1.4;
        }
        .video-header .channel {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
        .card-header h3 {
            font-size: 1.1rem;
            font-weight: 500;
            margin: 0;
            padding: 0;
            border: none;
        }
        .copy-icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        .copy-icon-btn:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }
        .copy-icon-btn svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .description {
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-secondary);
            max-height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            padding-right: 0.5rem;
        }
        
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .tag {
            background: rgba(255,255,255,0.08);
            color: var(--text-secondary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .stats-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .stat {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .stat .value {
            font-size: 1.2rem;
            font-weight: 500;
        }
        .stat .label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .thumbnails-list {
            list-style: none;
        }
        .thumbnail-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        .thumbnail-item:last-child {
            border-bottom: none;
        }
        .copy-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .copy-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        .copy-btn.copied {
            background-color: #28a745;
            border-color: #28a745;
            color: #fff;
        }

        .skeleton {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            background-color: rgba(255,255,255,0.08);
            border-radius: 8px;
        }
        @keyframes pulse {
            50% { opacity: .5; }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <a href="https://github.com/Thrynnex/YouTube-Analyser" target="_blank" class="github-btn">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
            <span>GitHub</span>
        </a>
    </div>

    <main class="container">
        <header>
            <h1>YouTube Analyzer</h1>
            <p>Paste any YouTube URL for a comprehensive, beautifully presented analysis that works flawlessly on any device.</p>
        </header>

        <div class="input-card">
            <input type="text" id="videoUrl" placeholder="Enter YouTube URL...">
            <button id="fetchButton">
                <span class="btn-text">Analyze</span>
                <div class="loader"></div>
            </button>
        </div>

        <div id="status-message"></div>
        <div id="dashboard" class="dashboard"></div>
    </main>
  
    <script>
        // Notice: The API_KEY is GONE from here! It's now secure on the backend.

        const fetchButton = document.getElementById('fetchButton');
        const videoUrlInput = document.getElementById('videoUrl');
        const dashboard = document.getElementById('dashboard');
        const statusMessage = document.getElementById('status-message');
        const COPY_ICON = `<svg viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" /></svg>`;
        const COPIED_ICON = `<svg viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" /></svg>`;

        fetchButton.addEventListener('click', handleFetchRequest);
        videoUrlInput.addEventListener('keyup', (e) => e.key === 'Enter' && handleFetchRequest());

        async function handleFetchRequest() {
            const url = videoUrlInput.value.trim();
            const videoId = getYouTubeVideoId(url);
            if (!videoId) {
                showStatus("Please enter a valid YouTube URL.", true);
                return;
            }
            await fetchVideoDetails(videoId);
        }

        function getYouTubeVideoId(url) {
            const patterns = /(?:v=|\/)([0-9A-Za-z_-]{11}).*/;
            const match = url.match(patterns);
            return match ? match[1] : null;
        }
        
        async function fetchVideoDetails(videoId) {
            toggleLoading(true);
            showStatus('');
            renderSkeleton();

            try {
              const response = await fetch(`/api/youtube?videoId=${videoId}`);
                const data = await response.json();

                // If our backend sent an error, show it.
                if (!response.ok) {
                    throw new Error(data.error || 'An unknown error occurred.');
                }
                
                if (!data.items || data.items.length === 0) {
                    throw new Error('Video not found. Please verify the URL.');
                }
                
                renderDashboard(data.items[0]);
            } catch (error) {
                showStatus(error.message, true);
                dashboard.innerHTML = '';
            } finally {
                toggleLoading(false);
            }
        }
        
       function toggleLoading(isLoading){fetchButton.disabled=isLoading}function showStatus(message,isError=!1){statusMessage.textContent=message;statusMessage.className=isError?"error":""}function renderSkeleton(){dashboard.innerHTML=`
            <div class="dashboard-layout">
                <div class="main-content"><div class="card video-header"><div class="skeleton" style="width:100%; aspect-ratio:16/9; margin-bottom:1.5rem;"></div><div class="skeleton" style="height:32px; width:90%;"></div><div class="skeleton" style="height:20px; width:50%; margin-top:0.5rem;"></div></div><div class="card description-card"><div class="skeleton" style="height:150px;"></div></div></div>
                <div class="sidebar"><div class="card stats-card"><div class="skeleton" style="height:120px;"></div></div><div class="card tags-card"><div class="skeleton" style="height:100px;"></div></div></div>
            </div>`;dashboard.classList.add("visible")}function renderDashboard(video){const{snippet:snippet,statistics:statistics}=video,tags=snippet.tags||[],formattedStats={views:Number(statistics.viewCount||0).toLocaleString(),likes:Number(statistics.likeCount||0).toLocaleString(),comments:Number(statistics.commentCount||0).toLocaleString()},thumbnailsHtml=Object.entries(snippet.thumbnails).map(([quality,data])=>`<li class="thumbnail-item"><span>${quality.charAt(0).toUpperCase()+quality.slice(1)} <span style="color:var(--text-secondary)">(${data.width}x${data.height})</span></span><button class="copy-btn" data-url="${data.url}">Copy</button>`).reverse().join("");dashboard.innerHTML=`
                <div class="dashboard-layout">
                    <div class="main-content">
                        <div class="card video-header" style="animation-delay: 0.1s;">
                            <img src="${snippet.thumbnails.maxres?.url||snippet.thumbnails.high.url}" class="thumbnail" alt="Video Thumbnail">
                            <div class="card-header" style="padding:0; border:none; margin:0;"><h2 class="title">${snippet.title}</h2><button class="copy-icon-btn" data-copy-target=".title"><span>${COPY_ICON}</span></button></div>
                            <p class="channel">By ${snippet.channelTitle}</p>
                        </div>
                        <div class="card" style="animation-delay: 0.3s;">
                            <div class="card-header"><h3>Description</h3><button class="copy-icon-btn" data-copy-target=".description"><span>${COPY_ICON}</span></button></div>
                            <p class="description">${snippet.description||"No description available."}</p>
                        </div>
                        <div class="card" style="animation-delay: 0.4s;"><h3>All Thumbnail URLs</h3><ul class="thumbnails-list">${thumbnailsHtml}</ul></div>
                    </div>
                    <div class="sidebar">
                        <div class="card" style="animation-delay: 0.2s;"><h3>Key Metrics</h3><div class="stats-grid"><div class="stat"><div class="value">${formattedStats.views}</div><div class="label">Views</div></div><div class="stat"><div class="value">${formattedStats.likes}</div><div class="label">Likes</div></div><div class="stat"><div class="value">${formattedStats.comments}</div><div class="label">Comments</div></div></div></div>
                         <div class="card" style="animation-delay: 0.5s;"><h3>Tags (${tags.length})</h3><div class="tags-container">${tags.length>0?tags.map(tag=>`<span class="tag">${tag}</span>`).join(""):`No tags found.`}</div></div>
                    </div>
                </div>`;dashboard.classList.add("visible");addCopyListeners()}function addCopyListeners(){document.querySelectorAll(".copy-btn").forEach(button=>{button.addEventListener("click",()=>{navigator.clipboard.writeText(button.dataset.url).then(()=>{button.textContent="Copied!";button.classList.add("copied");setTimeout(()=>{button.textContent="Copy";button.classList.remove("copied")},2e3)})})});document.querySelectorAll(".copy-icon-btn").forEach(button=>{button.addEventListener("click",()=>{const targetSelector=button.dataset.copyTarget,contentElement=button.closest(".card").querySelector(targetSelector);contentElement&&navigator.clipboard.writeText(contentElement.innerText).then(()=>{const originalContent=button.innerHTML;button.innerHTML=`<span>${COPIED_ICON}</span> Copied!`;setTimeout(()=>{button.innerHTML=originalContent},2e3)})})})}
    </script>
